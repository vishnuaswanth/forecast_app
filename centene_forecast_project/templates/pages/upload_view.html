{% extends 'index.html' %}

{% load static %}
{% block title %} {{ title }} {% endblock %}

{% block content2 %}
<div class="pagetitle">
    <h1 style="font-size:17px;">Data upload hub</h1>
</div><!-- End Page Title -->

<section class="section" style="font-family: Poppins;">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <!-- Action Links -->
                    <div class="row mb-3">
                        <div class="col-sm-12"></div>
                        <!-- <div class="col-sm-2">
                            <a onclick="downloadExcelTemplatefortask()" style="font-size:12px;">Download Template</a>
                        </div>
                        <div class="col-sm-2">
                            <a onclick="sampletemplatefortask()" style="font-size:12px;">Sample Template</a>
                        </div> -->
                    </div>

                    <!-- Upload Form -->
                    <form id="uploadForm" method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="row align-items-center">
                            <div class="col-sm-4">
                                <select class="form-select" name="filetype">
                                    <option value="roster">Roster file</option>
                                    <option value="forecast">Forecast file</option>
                                    <option value="prod_team_roster">Production Team Roster</option>
                                    <option value="altered_forecast">Updated Forecast File</option>
                                </select>
                            </div>
                            <div class="col-sm-4">
                                <input id="file_upload_input" type="file" class="form-control" name="file" accept=".csv, .xlsx" required autofocus>
                            </div>
                            <div class="col-sm-2">
                                <button type="submit" class="btn btn-primary" id="upload-btn">
                                    <i class="fas fa-upload"></i> Upload
                                </button>
                            </div>
                            <!-- <button type="reload" class="btn btn-light" id="upload-btn">
                                <i class="fa-solid fa-rotate"></i> reload
                            </button> -->
                        </div>

                        <!-- Progress & Messages -->
                        <div id="progress-container" class="mt-3" style="display: none;">
                            <div class="progress">
                                <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;">0%</div>
                            </div>
                        </div>

                        <!-- Information bar -->
                        <div class="alert alert-primary d-flex" role="alert">
                            <i class="fa-solid fa-circle-info fa-lg" style="
                                line-height: 1;
                                margin-right: .5rem;
                            "></i>
                            view the uploaded data in &ensp;
                            <a class="nav-link " href="{% url 'forecast_app:dataview'  %}">
                                <u><em> <span> Data Hub</span></em></u>
                            </a> 
                        </div>
                    </form>

                    <!-- Success or Error Messages -->
                    <div id="error-message" class="alert alert-danger mt-3" style="display: none;"></div>
                    <div id="successMsg" class="alert alert-success mt-3" style="display: none;">File uploaded successfully!</div>

                    <!-- Table Container -->
                    <div id="table-container" class="mt-4">
                        {% if row_data %}
                        <div class="table-responsive">
                            {% include  'components/table.html' with column_names=column_names  page_obj=row_data %}
                        </div>
                        {% else %}
                        <p>No data available.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}


{% block script %}
<script>
    var fileUploadUrl = "{% url 'forecast_app:upload' %}";
    var refreshTableUrl = fileUploadUrl;
    var checkProgressUrl = "{% url 'forecast_app:upload_progress' %}";
</script>
<script src="{% static 'centene_forecast_app/js/upload.js' %}"></script> 
{% endblock %}